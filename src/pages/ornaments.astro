---
import Layout from '../layouts/Layout.astro';

const pageTitle = "Ornament Instructions"

import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

import instructions from '../assets/ornaments/ornament-instructions.png';
const instructionsTranscribed = "DIY POP OUT ORNAMENT KIT INSTURCTIONS\n\n1. PAINT THE FRAME\nTo help from having tiny pieces to hold, paint your design right inside the frame! Use your brush to paint the sections to your liking but remember light coats work best! These small projects don't use a lot of paint and feel free to get creative adding dots and stripes if you choose!\n\n2. POP YOUR PIECES OUT\nJust like the old school pop-out kits! Gently apply pressure to each piece to pop it from the frame. If you need help on smaller pieces use the back end of your blue paint brush to help push. *If a piece should snap don't stress - they easily glue in place when you put it on your ornament base*\n\n3. GLUE IT ALL TOGETHER\nIt doesn\â€™t take much glue to hold these together! Put a few drops on the back of your 3D pieces and press down. If some glue seeps out you can wipe it up with your paint brush or just let it dry - it will dry clear. Give it a few minutes to set before adding your hanger so pieces don't shift while you're handling it.\n\n4. ADD YOUR HANGER, BEAD + BOW\nTie your jute in a loop on one end. On the doubled over side of your loop string on your bead. Slide the bead up close to the knot and then slide the jute loop into your ornament.\nWrap the doubled over end over your knot and bead but before pulling tight slide your ribbon into the loop your ornament runs through then pull the jute tight and slide the bead down to secure ribbon in place."

const rawImgs = import.meta.glob<{ default: ImageMetadata }>('../../src/assets/ornaments/*.jpg', { eager: true });
const ornamentImgs = Object.values(rawImgs).map(image => image.default);

// TO ADD ORNAMENTS: Add .jpg files to "src/assets/ornaments". They need to be .jpg's.
---

<Layout pageTitle={pageTitle}><br>
    <div class="container is-fluid" id="instructions">
        <div class="notification has-background-primary-soft">
            <div class="content">
                <h1>Ornament Instuctions</h1>
                <p>
                    If you bought one of our DIY ornament kits, 
                    this page has all the instructions you need to put one together, 
                    as well as an example image from each set.
                </p><p>
                    You can click on any of the images in this page (including the instructions) to open them in a larger view.
                </p>
            </div>
        </div>

        <div class="columns">
            <div class="column is-half-tablet is-half-desktop is-one-third-widescreen">
                <button class="js-modal-trigger" data-target=`modal-instructions`>
                    <Image class="ornament-image" src={instructions} alt={instructionsTranscribed}/>
                </button>
            </div>

            <div class="column">
                <div class="grid">
                {ornamentImgs.map(ornament => 
                    <div class="cell">
                        <button class="js-modal-trigger" data-target=`modal-${ornament.src}`>
                            <Image class="ornament-image" src={ornament} alt="An ornament">
                        </button>
                    </div>
                )}
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id=`modal-instructions`>
        <div class="modal-background"></div>
        <div class="modal-content">
            <Image class="ornament-image" src={instructions} alt="An ornament">
        </div>
        <button class="modal-close is-large" aria-label="close"></button>
    </div>

    {ornamentImgs.map(ornament => 
        <div class="modal" id=`modal-${ornament.src}`>
            <div class="modal-background"></div>
            <div class="modal-content">
                <Image class="ornament-image" src={ornament} alt={instructionsTranscribed} /> 
            </div>
            <button class="modal-close is-large" aria-label="close"></button>
        </div>
    )}
</Layout>


<style>
    .ornament-image {
        border-radius: 10px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
            $el.classList.add('is-active');
        }

        function closeModal($el) {
            $el.classList.remove('is-active');
        }

        function closeAllModals() {
            (document.querySelectorAll('.modal') || []).forEach(($modal) => {
            closeModal($modal);
            });
        }

        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
            const modal = $trigger.dataset.target;
            const $target = document.getElementById(modal);

            $trigger.addEventListener('click', () => {
            openModal($target);
            });
        });

        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
            const $target = $close.closest('.modal');

            $close.addEventListener('click', () => {
            closeModal($target);
            });
        });

        // Add a keyboard event to close all modals
        document.addEventListener('keydown', (event) => {
            if(event.key === "Escape") {
            closeAllModals();
            }
        });
    });
</script>